= simple_form_for @incedent, url: (@incedent.id.nil? ? add_incedent_path() : @incedent), html: { id: 'form', class: 'form-horizontal form', multipart: true } do |f|
  .form-header
    %h3= @form_title
  .form-inputs
    .container-fluid
      .row-fluid
        .span8
          = f.input :name, label: 'Имя', input_html: { class: 'form-input' }
          = f.input :description, label: 'Описание', input_html: { class: 'form-input', id: 'incedent_markdown'  }
        .span4
          - if current_user.has_role? :admin
            = f.association :operator, include_blank: false, label: 'Оператор', input_html: { class: 'form-input' }
            = f.association :initiator, include_blank: false, label: 'Инициатор', input_html: { class: 'form-input' }
            = f.association :worker, include_blank: true, label: 'Исполнитель', input_html: { class: 'form-input' }
            = f.association :observer, include_blank: true, label: 'Наблюдатель', input_html: { class: 'form-input' }
            = f.association :server, include_blank: true, label: 'Оборудование', input_html: { class: 'form-input' }
            = f.association :status, include_blank: false, label: 'Статус', input_html: { class: 'form-input' }
          - elsif current_user.has_role? :manager
            = f.association :initiator, include_blank: false, label: 'Инициатор', input_html: { class: 'form-input' }
            = f.association :worker, include_blank: true, label: 'Исполнитель', input_html: { class: 'form-input' }
            = f.association :server, include_blank: true, label: 'Оборудование', input_html: { class: 'form-input' }
            = f.input :operator_id, as: :hidden
            = f.input :observer_id, as: :hidden
            = f.input :status_id, as: :hidden
          - elsif current_user.has_role? :executor
            = f.association :initiator, include_blank: false, label: 'Инициатор', input_html: { class: 'form-input' }
            = f.association :server, include_blank: true, label: 'Оборудование', input_html: { class: 'form-input' }
            = f.input :operator_id, as: :hidden
            = f.input :worker_id, as: :hidden
            = f.input :observer_id, as: :hidden
            = f.input :status_id, as: :hidden
          - elsif current_user.has_role? :operator
            = f.association :initiator, include_blank: false, label: 'Инициатор', input_html: { class: 'form-input' }
            = f.association :server, include_blank: true, label: 'Оборудование', input_html: { class: 'form-input' }
            = f.input :operator_id, as: :hidden
            = f.input :worker_id, as: :hidden
            = f.input :observer_id, as: :hidden
            = f.input :status_id, as: :hidden
          - elsif current_user.has_role? :client
            = f.input :operator_id, as: :hidden
            = f.input :initiator_id, as: :hidden
            = f.input :worker_id, as: :hidden
            = f.input :observer_id, as: :hidden
            = f.input :status_id, as: :hidden
            = f.input :server_id, as: :hidden

          = f.association :priority, include_blank: false, label: 'Приоритет', input_html: { class: 'form-input' }
          = f.association :type, include_blank: false, label: 'Тип', input_html: { class: 'form-input' }
          = f.input :finish_at, as: :datetime, label: 'Срок исполнения', input_html: { class: 'form-input', readonly: true, value: @incedent.finish_at.strftime('%d.%m.%Y 23:59') }
      .row-fluid
        .span12
          = f.association :tags, as: :check_boxes, label: 'Метки', input_html: { class: 'form-input' }
      .row-fluid
        .span12
          #attaches
            - if @incedent.persisted?
              = render partial: 'attaches', locals: { incedent: @incedent, f: f }
          = add_object_link(glyph(:plus)+' Прикрепить файл', f, Attach.new, 'file', '#attaches')
  .form-actions
    .pull-right.btn-group
      = f.submit @button_title+' [Ctrl+Enter]', class: 'btn btn-success'
      = link_to 'Отмена [Esc]', incedents_path, class: 'btn'

:javascript
  $("#incedent_name").focus();